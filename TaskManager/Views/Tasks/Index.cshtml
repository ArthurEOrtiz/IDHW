@{
  Layout = "_Layout";
  ViewData["Title"] = "Tasks";
}
@model IEnumerable<TaskManager.Models.UserTask>

<h2>Tasks</h2>

<table class="table">
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th>Is Completed</th>
      <th>Due Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    @foreach (var task in Model)
    {
      <tr>
        <td>@task.Title</td>
        <td>@task.Description</td>
        <td>@task.IsCompleted</td>
        <td>@task.DueDate.ToString("yyyy-MM-dd")</td>
        <td>
          <button onclick="openEditModal(
                '@task.Id',
                '@task.Title',
                '@task.Description',
                '@task.DueDate.ToString("yyyy-MM-dd")'
              )"
                  class="btn btn-primary">
            Edit
          </button>

          <a asp-action="Delete" asp-controller="Tasks" asp-route-id="@task.Id" class="btn btn-danger">Delete</a>
        </td>
      </tr>
    }
  </tbody>
</table>

<!-- Button to trigger the Create Task modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createTaskModal">
  Create New Task
</button>

<!-- Create Task Modal -->
<div class="modal fade" id="createTaskModal" tabindex="-1" aria-labelledby="createTaskModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createTaskModalLabel">Create Task</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        @{
          ViewBag.Action = "Create";
          ViewBag.ButtonText = "Create Task";
        }
        @await Html.PartialAsync("_TaskForm", new TaskManager.Models.UserTask())
      </div>
  </div>
</div>

<!-- Edit Modal Container -->
<div id="editModalContainer"></div>

<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/js/tasks/editModal.js"></script>